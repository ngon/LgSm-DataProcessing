{
    "contents" : "# process phenotype for Natalia #\n\n###### GO TO DIRECTORY\nsetwd(\"/group/palmer-lab/AIL/LgSm-DataProcessing\")\n\n###### CONSTANTS\nMAF=0.05\n\n#### Read genotype sample names\n#### Change sample names -\n#### 54109_11 changed to 54109 (double ear tag)\n#### 51717-19 changed to 51717 (double ear tag)\n#### 51348 changed to 51349 (inferred from pedigree checks) - possible typo - double check using sex(genotypes on X).\ngeno.samples <- read.table(\"/group/palmer-lab/AIL/GBS/dosage/genotyped.samples.txt\", as.is=TRUE)\ngeno.samples[which(geno.samples$V1 == \"54109_11\"), 1] <- \"54109\"\ngeno.samples[which(geno.samples$V1 == \"51717-19\"), 1] <- \"51717\"\ngeno.samples[which(geno.samples$V1 == \"51348\"), 1]    <- \"51349\"\nnames(geno.samples) <- c(\"id\")\n\n#### Read phenotype file\npheno     <- read.table(\"pheno.noHeader.txt\", as.is=TRUE)\npheno.names <- read.table(\"pheno.names.txt\", skip=1, as.is=T)[,2]\nnames(pheno) <- pheno.names\n\n#### Generate the phenotype data for all samples with genotypes\npheno.allgeno <- merge(geno.samples, pheno, all.x=TRUE)\nwrite.table(pheno.allgeno, file=\"phenos.allgeno.txt\", quote=FALSE, sep=\"\\t\", row.names=FALSE, col.names=FALSE)\n\n#### Read master covariate file\ncovars        <- read.table(\"cov.noHeader.txt\", sep=\"\\t\", as.is=T)\ncovar.names   <- read.table(\"cov.names.txt\", skip=1, as.is=T)$V1\nnames(covars) <- covar.names\n\n#### Change the sex covariate to an indicator variable\ncovars$sex    <- replace(covars$sex, covars$sex == \"M\", \"0\")\ncovars$sex    <- replace(covars$sex, covars$sex == \"F\", \"1\")\ncovars$sex    <- as.numeric(covars$sex)\n\n#### Change the batch and ppi.box covariates to set of indicator variables for gemma\n#### Convert generation to factor as well.\nbatches       <- unique(covars$batch)\n#batches       <- batches[-1]\nfor (batch in batches) {\n  covars[,paste0(\"is.batch\", batch)]  <- as.integer(covars$batch == batch)\n}\nboxes         <- unique(covars$ppi.box[which(!is.na(covars$ppi.box))])\n#boxes         <- boxes[-1]\nfor (box in boxes) {\n  covars[,paste0(\"is.ppi.box\", box)] <- as.integer(covars$ppi.box == box)\n}\nboxes         <- unique(covars$cpp.box[which(!is.na(covars$cpp.box))])\n#boxes         <- boxes[-1]\nfor (box in boxes) {\n  covars[,paste0(\"is.cpp.box\", box)] <- as.integer(covars$cpp.box == box)\n}\ngens          <- unique(covars$gen)\n#gens          <- gens[-1]\nfor (gen in gens) {\n    covars[,paste0(\"is.gen\", gen)] <- as.integer(covars$gen == gen)\n}\n\n#### Make covariate file with all ids in gentype file\ncovars <- merge(geno.samples, covars, all.x=TRUE)\ncovars$one <- 1\n\n####### Code for anova testing batch having a significant explantory power on outcome\n####### and batch 13 as being different from rest of batches in terms of outcome\n#cpp8.t <- pheno$cpp8.t\n#batch <- as.factor(covars$batch)\n#anova.cpp <- anova(lm(cpp8.t~batch))\n#anova.cpp <- anova(lm(cpp8.t~covars$is.batch13))\n#anova.cpp <- anova(lm(cpp8.t~as.factor(covars$cpp.box)))\n\n### covariates for each trait #### updated by Natalia 2/6/15\ntraitcovs <- vector(\"list\", length=17)\n\nnames(traitcovs) <- c(\"cpp.diff\", \"act2.t\", \"act4.t\", \"wild.binary\", \"ppi6.logit\", \"ppi12.logit\", \n                      \"cpp8.1\", \"cpp8.t\", \"sens\", \"act1.t\", \"ppi3.logit\",\n                      \"startle\", \"habituation\", \"act3.t\", \"act5.t\", \"act8.t\",\"glucose\")\n                      \n                      \ntraitcovs[[\"cpp.diff\"]]  <- list(\"one\", \"sex\", \"is.cpp.box2\", \"is.cpp.box3\", \"is.cpp.box4\", \n                                \"is.cpp.box7\", \"is.cpp.box11\", \"is.cpp.box12\") \n\ntraitcovs[[\"cpp8.1\"]]  <- list(\"one\", \"sex\", \"is.cpp.box2\", \"is.cpp.box3\", \"is.cpp.box4\", \n                        \"is.cpp.box8\", \"is.cpp.box10\", \"is.cpp.box11\", \"is.cpp.box12\") \n\ntraitcovs[[\"cpp8.t\"]]  <- list(\"one\", \"sex\", \"is.gen53\", \"is.gen56\", \"is.batch2\", \"is.batch10\", \"is.batch13\",\"is.batch15\", \"is.batch21\", \"is.cpp.box2\", \"is.cpp.box3\", \"is.cpp.box4\", \"is.cpp.box6\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box9\", \"is.cpp.box10\", \"is.cpp.box11\", \"is.cpp.box12\", \"comerr8\") \n\ntraitcovs[[\"sens\"]]    <- list(\"one\", \"sex\", \"is.gen52\", \"is.cpp.box7\", \"is.batch8\") \n\ntraitcovs[[\"act1.t\"]]  <- list(\"one\", \"sex\", \"is.batch14\", \"is.cpp.box3\", \"is.cpp.box4\", \"is.cpp.box5\", \"is.cpp.box6\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box9\", \"is.cpp.box11\", \"is.cpp.box12\", \"comerr1\")\n\ntraitcovs[[\"act2.t\"]]  <- list(\"one\", \"sex\", \"is.gen52\",\"is.gen56\", \"is.cpp.box5\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box10\", \"is.cpp.box12\", \"is.batch8\") \n\ntraitcovs[[\"act4.t\"]]  <- list(\"one\", \"sex\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box11\") \n\ntraitcovs[[\"wild.binary\"]]    <- list(\"one\", \"sex\")\n\ntraitcovs[[\"ppi3.logit\"]] <- list(\"one\", \"sex\", \"is.ppi.box3\", \"ppi.weight\", \"is.batch4\")\ntraitcovs[[\"ppi6.logit\"]] <- list(\"one\", \"sex\", \"is.ppi.box3\", \"is.ppi.box4\", \"ppi.weight\")\ntraitcovs[[\"ppi12.logit\"]] <- list(\"one\", \"sex\", \"is.ppi.box3\", \"is.ppi.box4\",\"ppi.weight\", \n                            \"is.batch3\", \"is.batch4\", \"is.batch7\", \"is.batch9\")\n\ntraitcovs[[\"startle\"]] <- list(\"one\", \"is.ppi.box3\", \"is.ppi.box4\", \"ppi.weight\", \"is.batch2\", \"is.batch16\", \"is.batch17\") # shyam: is sex excluded for a reason - ## natalia: see comment under avg.ppi\n\ntraitcovs[[\"habituation\"]] <- list(\"one\", \"ppi.weight\") \n\ntraitcovs[[\"act3.t\"]]  <- list(\"one\", \"sex\", \"is.gen51\", \"is.gen52\", \"is.gen53\", \"is.gen54\", \"is.gen55\", \"is.batch2\", \"is.batch3\", \"is.batch4\", \"is.batch5\", \"is.batch6\", \"is.batch7\", \"is.batch8\", \"is.batch9\", \"is.batch10\", \"is.batch11\", \"is.batch12\", \"is.batch13\", \"is.batch21\", \"is.batch22\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box10\", \"is.cpp.box11\", \"is.cpp.box12\") \n\ntraitcovs[[\"act5.t\"]]  <- list(\"one\", \"sex\", \"is.gen51\", \"is.gen53\", \"is.gen54\", \"is.gen55\", \"is.gen56\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.batch7\", \"is.batch13\", \"is.batch15\", \"is.batch20\", \"is.batch21\", \"is.batch22\") \n\ntraitcovs[[\"act8.t\"]]  <- list(\"one\", \"sex\", \"is.gen56\", \"is.cpp.box3\", \"is.cpp.box4\", \"is.cpp.box6\", \"is.cpp.box7\", \"is.cpp.box8\", \"is.cpp.box9\", \"is.cpp.box11\", \"is.cpp.box12\", \"is.batch3\", \"is.batch7\") \n\ntraitcovs[[\"glucose\"]] <- list(\"one\", \"sex\", \"glu.weight\")\n\n\n#################### Make script to run Gemma for chosen trait ##############\ncmds <- c()\nfor (trait in names(traitcovs)) {\n    index.pheno     <- which(pheno.names == trait)\n    chosen.covars   <- covars[, unlist(traitcovs[[trait]])]\n    write.table(chosen.covars, file=paste0(\"/group/palmer-lab/AIL/qtlmapping/covariates/\", trait, \".covs\"), sep=\"\\t\", quote=F, row.names=F, col.names=F)\n    for (chrom in 1:19) {\n        cmds <- c(cmds, paste0(\"gemma -g /group/palmer-lab/AIL/GBS/dosage/chr\", chrom, \".filtered.dosage -p /group/palmer-lab/AIL/LgSm-DataProcessing/phenos.allgeno.txt -k /group/palmer-lab/AIL/qtlmapping/kinship/chrNot\", chrom,\".cXX.txt -a /group/palmer-lab/AIL/GBS/dosage/chr\", chrom, \".filtered.snpinfo -c /group/palmer-lab/AIL/qtlmapping/covariates/\", trait, \".covs -lmm 2 -maf \", MAF, \" -o \", trait, \".chr\", chrom, \" -n \", index.pheno))\n    }\n}\nwrite.table(cmds, file=paste0(\"/group/palmer-lab/AIL/code/gemma.alltraits.cmds\"), row.names=F, col.names=F, quote=F)\n\n",
    "created" : 1425578205169.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3258448738",
    "id" : "672022F0",
    "lastKnownWriteTime" : 1425578338,
    "path" : "C:/Users/Administrator/Desktop/Scripts/LgSm-DataProcessing/scripts/map.ail.QTL.R",
    "project_path" : "scripts/map.ail.QTL.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}