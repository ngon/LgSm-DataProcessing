{
    "contents" : "######## Auxillary code to generate plots ###############\n\n## Working directory on Natalia's computer PalmerLab-Atlas\nsetwd(\"C:/Users/Administrator/Desktop/Scripts/LgSm-DataProcessing/figures/manhattan\")\n\n\n## First, read in chrLengths from the mm10 reference. \n## In CRI: 'group/palmer-lab/reference_genomes/mouse/chrLengths_mm10_chrnames.txt'\nchrLens    <- read.table(\"chrLengths_mm10.txt\")$V2\nchrLens    <- c(0, cumsum(chrLens*1.0))\n\nlabPos     <- read.table(\"chrLengths_mm10.txt\")$V2/2.0\nlabPos     <- chrLens[1:19]+labPos\n\n\ntraits <- c(\"cpp.diff\", \n            #\"cpp8.1\", \n            #\"cpp8.t\",\n            \"act1.t\",\n            \"act2.t\", \n            #\"act4.t\", \n            #\"act5.t\",\n            #\"act8.t\", \n            #\"sens\", \n            #\"startle\", \n            #\"wild\", \n            #\"ppi3\", \n            \"ppi6\"\n            #\"ppi12\"\n            #\"habituation\", \n            #\"glucose\"\n            )\n\ntitles <- c(\"Change in preference for meth paired side\", \n            #\"Time spent on meth paired side on day 8 (5 min)\", \n            #\"Time spent on meth paired side on day 8 (30 min)\", \n            \"Locomotor response to novelty (Day 1 activity)\",\n            \"Locomotor response to meth (Day 2 activity)\", \n            #\"Day 4 activity (1 mg/kg meth)\", \n            #\"Day 5 activity (saline)\",\n            #\"Day 8 activity (saline)\",\n            #\"Locomotor sensitization to meth\", \n            #\"Acoustic startle reflex\", \n            #\"Wildness (number of escapes during CPP)\", \n            #\"Prepulse inhibition (73 dB)\",\n            \"Prepulse inhibition (76 dB)\" \n           # \"Prepulse inhibition (82 dB)\",\n            #\"Habituation to acoustic startle\",\n            #\"Blood glucose levels after a 4h fast\"\n            )\n\noutfiles <- paste0(traits, \".manhattan.png\")\n\ntraits<- c(\"startle\", \"ppi12\")\ntitles<- c(\"Acoustic startle reflex\", \"Prepulse inhibition (82 dB)\")\noutfiles <- paste0(traits, \".manhattan.png\")\n\nfor (index in 1:4) {\n        print(paste(\"Starting trait\", traits[index]))\n        plotManhattan(traits[index], outfile=outfiles[index], title=titles[index])\n        print(paste(\"Done with trait\", traits[index]))\n}\n\n\n\n\n\nplotManhattan <- function(trait, outfile=NULL, \n                          oddcolor=\"#ff6040\", evencolor=\"#aab0be\", \n                          signifLine=5, signifColor=\"#000000\", title=NULL) {\n        if (is.null(outfile)) {\n                outfile <- paste0(trait, \".manhattan.png\")\n        }\n        if (is.null(title)) {\n                title = trait\n        }\n        png(file=outfile, height=600, width=1400, bg=\"transparent\")\n        pvals <- c()\n        positions <- c()\n        cols <- c()\n        \n        for (chrom in 1:19) {\n                filename <- paste0(trait, \".chr\", chrom, \".assoc.txt\")\n                print(paste(\"Starting chromosome\", chrom))\n                output <- read.table(filename, header=T, as.is=TRUE)\n                output$chr <- as.numeric(sub(\"chr\", \"\", output$chr))\n                pvals <- c(pvals, -log10(output$p_lrt))\n                positions <- c(positions, chrLens[output$chr]+output$ps)\n                if (chrom %% 2) {\n                        cols <- c(cols, rep(oddcolor, nrow(output)))\n                } else {\n                        cols <- c(cols, rep(evencolor, nrow(output)))\n                }\n                print(paste(\"Done with chromosome\", chrom))\n        }\n        plot(positions, pvals, col=cols, pch=19, cex=0.78, main=title, ylab='-log10(p-value)', xlab='Position', axes=F, frame.plot=T, cex.lab=1.7, cex.main=1.8, font.main=1, ylim =c(0,7) )\n        axis(2, cex.axis=1.5)\n        axis(1, at=labPos, labels=1:19, tick=F, cex.axis=1.5)\n        abline(h=signifLine, col=signifColor, lty=2)\n        dev.off()\n}\n\n__________________________________________\n\n### zoom plot for cpp.diff - ch4\n\n# cppdiff.ch4 <- read.table(\"cpp.diff.chr4.assoc.txt\", sep=\"\\t\", header=T )\n# test<-cppdiff.ch4[order(cppdiff.ch4$ps),]\n# plotZoom(trait=\"cpp.diff\", chrom=4, start=89803883, end=114867413)\n# \n# ppi6.ch8 <- read.table(\"ppi6.chr8.assoc.txt\", sep=\"\\t\", header=T )\n# test<-ppi6.ch8[order(ppi6.ch8$ps),]\n# plotZoom(trait=\"ppi6\", chrom=8, start=69822096, end=95001306)\n# \n# ppi12.ch8 <- read.table(\"ppi12.chr8.assoc.txt\", sep=\"\\t\", header=T )\n# test<-ppi12.ch8[order(ppi12.ch8$ps),]\n# plotZoom(trait=\"ppi12\", chrom=8, start=69822096, end=95001306)\n# \n# startle17 <- read.table(\"startle.chr17.assoc.txt\", sep=\"\\t\", header=T )\n# test<-startle17[order(startle17$ps),]\n# plotZoom(trait=\"startle\", chrom=17, start=18998527, end=35964216)\n# \n# startle7 <- read.table(\"startle.chr7.assoc.txt\", sep=\"\\t\", header=T )\n# test<-startle7[order(startle7$ps),]\n# plotZoom(trait=\"startle\", chrom=7, start=75001287, end=84997578)\n# \n# cpp5min.7 <- read.table(\"cpp8.1.chr7.assoc.txt\", sep=\"\\t\", header=T )\n# test<-cpp5min.7[order(cpp5min.7$ps),]\n# plotZoom(trait=\"cpp8.1\", chrom=7, start=75001287, end=99997517)\n# \n# act1t7 <- read.table(\"act1.t.chr7.assoc.txt\", sep=\"\\t\", header=T )\n# test<-act1t7[order(act1t7$ps),]\n# plotZoom(trait=\"act1.t\", chrom=7, start=75001287, end=99997517)\n# \n# act1t17 <- read.table(\"act1.t.chr17.assoc.txt\", sep=\"\\t\", header=T )\n# test<-act1t17[order(act1t17$ps),]\n# plotZoom(trait=\"act1.t\", chrom=17, start=, end=)\n# \n# act2t7 <- read.table(\"act2.t.chr7.assoc.txt\", sep=\"\\t\", header=T )\n# test<-act2t7[order(act2t7$ps),]\n# plotZoom(trait=\"act2.t\", chrom=7, start=30000032, end=45847045)\n# \n# act2t17 <- read.table(\"act2.t.chr17.assoc.txt\", sep=\"\\t\", header=T )\n# test<-act2t17[order(act2t17$ps),]\n# plotZoom(trait=\"act2.t\", chrom=17, start=75999608, end= 85035207)\n\nact2t4 <- read.table(\"act2.t.chr4.assoc.txt\", sep=\"\\t\", header=T )\ntest<-act2t4[order(act2t4$ps),]\nplotZoom(trait=\"act2.t\", chrom=4, start=127158422, end=134999602)\n\nact5t4 <- read.table(\"act5.t.chr4.assoc.txt\", sep=\"\\t\", header=T )\ntest<-act5t4[order(act5t4$ps),]\nplotZoom(trait=\"act5.t\", chrom=4, start=127158422, end=134999602)\n\n\n\n\nplotZoom <- function(trait, chrom, start, end, outfile=NULL, dotColor=\"#aab0be\", signifLine=5, signifColor=\"#000000\", title=NULL, scaling=1e6, scalename=\"(Mb)\") {\n    if (is.null(outfile)) {\n        outfile <- paste0(trait, \".chr\", chrom, \".\", as.character(start), \".\", as.character(end), \".zoom.jpg\")\n    }\n    if (is.null(title)) {\n        title = trait\n    }\n    jpeg(file=outfile, quality=95)\n    filename <- paste0(trait, \".chr\", chrom, \".assoc.txt\")\n    print(paste(\"Starting chromosome\", chrom))\n    output <- read.table(filename, header=T)\n    pvals <- -log10(output$p_lrt)\n    positions <- output$ps/scaling\n    print(paste(\"Done with chromosome\", chrom))\n    ### Code to plot\n    start = start/scaling\n    end = end/scaling\n    plot(positions, pvals, col=dotColor, pch=19, cex=0.75, main=title, ylab='-log10(p-value)', xlab=paste('Position', scalename), axes=F, frame.plot=T, cex.lab=1.1, xlim=c(start, end))\n    axis(2, cex.axis=1.2)\n    axis(1, cex.axis=1.2)\n    abline(h=signifLine, col=signifColor, lty=2)\n    dev.off()        \n}\n\n\n\n\n\n\n",
    "created" : 1424303776826.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1112573317",
    "id" : "A24495B2",
    "lastKnownWriteTime" : 1424321499,
    "path" : "C:/Users/Administrator/Desktop/Scripts/LgSm-DataProcessing/figures/manhattan/plotQTL.R",
    "project_path" : "figures/manhattan/plotQTL.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_source"
}