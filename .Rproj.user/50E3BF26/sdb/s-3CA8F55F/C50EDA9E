{
    "contents" : "setwd(\"  \")\ndownload.file(\"https://raw.github.com/stephenturner/qqman/master/qqman.r\", \n              destfile=\"./qqman.r\")\nsource(\"./qqman.r\")\nlibrary(\"ggplot2\")\n\n#Code to plot manhattanplot\nchrLens    <- read.table('chrLengths_mm9.txt')$V2\nchrLens    <- c(0, cumsum(chrLens*1.0))\nlabPos     <- (read.table('chrLengths_mm9.txt')$V2)/2.0\nlabPos     <- chrLens[1:19]+labPos\n\nfilenames <- c('output/ail.day1.total.assoc.txt', \n               'output/ail.day1.bin1.assoc.txt', \n               'output/ail.day2.total.assoc.txt', \n               'output/ail.day4.total.assoc.txt', \n               'output/ail.day2minus4.total.assoc.txt', \n               'output/cpp.diff.assoc.txt', \n               'output/cpp.day8.prop.assoc.txt', \n               'output/cpp.day8.first5.assoc.txt', \n               'output/glucose.assoc.txt')\n\ntraitNames <- c('Locomotor response to novelty F50-51 \\n Total Activity on Day 1',\n                'Locomotor response to novelty F50-51 \\n First 5 min of Activity on Day 1', \n                'Day 2 total distance', \n                'Day 4 total distance', \n                'Sensitization - difference in day 4 and day 2 activity', \n                'Difference in proportion of time spent\\n in left chamber day 1 to day 8', \n                'Proportion of time spent in left chamber on day 8', \n                'Amount of time spent in first 5 minutes\\non day 8 in left chamber', \n                'Glucose measure')\n\n\ncppDiff <- read.table(file=\"cpp.diff.assoc.txt\", header=T)\ncpp <- cbind(cppDiff$rs, cppDiff$chr, cppDiff$ps, cppDiff$p_lrt)\ncpp <- as.data.frame(cpp)\nnames(cpp) <- c(\"SNP\", \"CHR\", \"BP\", \"P\")\nsum(is.na(cpp$P)) # 0 \n\nglucose <- read.table(file=\"glucose.assoc.txt\", header=T)\ngluc <- cbind(glucose$rs, glucose$chr, glucose$ps, glucose$p_lrt)\ngluc <- as.data.frame(gluc)\nnames(gluc) <- c(\"SNP\", \"CHR\", \"BP\", \"P\")\nsum(is.na(gluc$P)) #0\n\nday2 = read.table(file=\"ail.day2.total.assoc.txt\", header=T)\nd2 = cbind(day2$rs, day2$chr, day2$ps, day2$p_lrt)\nd2 = as.data.frame(d2)\nnames(d2) <- c(\"SNP\", \"CHR\", \"BP\", \"P\")\nsum(is.na(d2$P)) #0\n\nday4 = read.table(file=\"ail.day4.total.assoc.txt\", header=T)\nd4 = cbind(day4$rs, day4$chr, day4$ps, day4$p_lrt)\nd4 = as.data.frame(d4)\nnames(d4) <- c(\"SNP\", \"CHR\", \"BP\", \"P\")\nsum(is.na(d4$P)) #0\n\n\n\nchr14snps = subset(d4, d4$CHR == \"14\",)\nchr14snps = chr14snps[with(chr14snps, order(P, BP)),]\n\nchr18snps = subset(gluc, gluc$CHR == \"18\",)\nchr18snps = chr18snps[with(chr18snps, order(P, BP)),]\n\nchr9snps = subset(cpp, cpp$CHR == \"9\",)\nchr9snps = chr9snps[with(chr9snps, order(P, BP)),]\n\n\n\n\nmanhattan <- function(dataframe, \n                      limitchromosomes=NULL,\n                      pt.col=c('gray10','gray50'),\n                      pt.bg=c('gray10','gray50'),\n                      pt.cex=0.45,\n                      pch=21, \n                      cex.axis=0.7,\n                      gridlines=F,\n                      gridlines.col='gray83',\n                      gridlines.lty=1,\n                      gridlines.lwd=1,\n                      ymax=8, \n                      ymax.soft=T, \n                      annotate=NULL,\n                      annotate.cex=0.7,\n                      annotate.font=3,\n                      suggestiveline=-log10(1e-5), \n                      suggestiveline.col='blue', \n                      suggestiveline.lwd=1.5, \n                      suggestiveline.lty=1,\n                      genomewideline=-log10(5e-8), \n                      genomewideline.col='red', \n                      genomewideline.lwd=1.5, \n                      genomewideline.lty=1,\n                      highlight=NULL,\n                      highlight.col=c('green3','magenta'),\n                      highlight.bg=c('green3','magenta'), ...) {\n        \n        col=c(\"orange\", \"orangered\")\n        col=c(\"darkgoldenrod1\", \"darkorange\")\n        col=c(\"green3\", \"palegreen2\")\n        col=c(\"slateblue\", \"salmon2\")\n        \n        \n        cpp= manhattan(cpp, limitchromosomes=1:19, pch=20, ymax=6,\n                       main=\"CPP for 1 mg/kg MA in F50-51 (N=362) \\n Final preference - initial preference\",          \n                       pt.col=col, pt.bg=col, cex.axis = 1.5, cex.lab=2, cex.main=2,\n                       genomwideline=NULL, suggestiveline=NULL)\n        \n        gluc = manhattan(gluc, limitchromosomes=1:19, pch=20, ymax=6,\n                         main=\"Blood glucose after a four-hour fast in F50-51 (N=362)\",          \n                         pt.col=col, pt.bg=col, cex.axis = 1.5, cex.lab=2, cex.main=2,\n                         genomwideline=NULL, suggestiveline=NULL)\n        \n        \n        day2 = manhattan(d2, limitchromosomes=1:19, pch=20, ymax=6,\n                         main=\"Locomotor response to MA in F50-51 (N=362) \\n Day 2\",          \n                         pt.col=col, pt.bg=col, cex.axis = 1.5, cex.lab=2, cex.main=2,\n                         genomwideline=NULL, suggestiveline=NULL)\n        \n        day4 = manhattan(d4, limitchromosomes=1:19, pch=20, ymax=6,\n                         main=\"Locomotor response to MA in F50-51 (N=362)\",          \n                         pt.col=col, pt.bg=col, cex.axis = 1.5, cex.lab=2, cex.main=2,\n                         genomwideline=NULL, suggestiveline=NULL)\n        \n        manhattan(subset(d4, CHR==7), pch=20, pt.cex = .9, annotate=NULL, ymax=6, pt.col=\"orange\", \n                  cex.axis = 1.5, cex.lab=2, cex.main=2,  genomwideline=NULL, suggestiveline=NULL,\n                  main=\"Locomotor response to MA\")\n        manhattan(subset(cpp, CHR==2), pch=20, pt.cex = .9, annotate=NULL, ymax=6, pt.col=\"orangered\", \n                  cex.axis = 1.5, cex.lab=2, cex.main=2,  genomwideline=NULL, suggestiveline=NULL,\n                  main=\"CPP for 1 mg/kg MA\")\n        manhattan(subset(gluc, CHR==18), pch=20, pt.cex = .9, annotate=NULL, ymax=6, pt.col=\"orangered\", \n                  cex.axis = 1.5, cex.lab=2, cex.main=2,  genomwideline=NULL, suggestiveline=NULL,\n                  main=\"Fasting blood glucose\")\n        \n        \n        plotManhattan <- function(gemmaout, trait) {\n                output <- read.table(gemmaout, header=T)\n                pvals <- output$p_lrt\n                pvals <- -log10(pvals)\n                positions <- chrLens[output$chr]+output$ps\n                cols <- output$chr\n                odds <- which(cols%%2 == 1)\n                cols[which(cols%%2 == 0)] = 'dark red'\n                cols[odds] = 'dark blue'\n                plot(positions, pvals, col=cols, pch=19, cex=0.5, main=trait, ylab='-log10(p-value)', xlab='Position', axes=F, frame.plot=T)\n                #  abline(h=-log10(0.05/length(pvals)), lty=2, col='orangered')\n                axis(2)\n                axis(1, at=labPos, labels=1:19, tick=F)\n        }\n        \n        for (i in 1:12) {\n                pdf(paste0('manhattan.trait.',i,'.pdf'))\n                plotManhattan(filenames[i], traitNames[i])\n                dev.off()\n        }\n        \n        require(qvalue)\n        qvals.all <- c()\n        pi0.all   <- c()\n        #Obtain the 10% FDR threshold for all the traits.\n        for (file in filenames) {\n                #Read the p-values in from the gemma output file\n                output    <- read.table(file, header=T)\n                pvals     <- output$p_lrt\n                qvals     <- qvalue(pvals, fdr.level=0.1)\n                qvals.all <- cbind(qvals.all, qvals$qvalues)\n                pi0.all   <- c(pi0.all, qvals$pi.0)\n                print(paste(file, 'done'))\n        }\n        ",
    "created" : 1424291835314.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2924442699",
    "id" : "C50EDA9E",
    "lastKnownWriteTime" : 1412368675,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}